# TO-DOS


## Research Expense Standards for Cash Flow Analysis - 2026-02-10 20:47

- **Research and improve expense estimation in cash flow calculation** - Investigate industry-standard approaches for estimating operating expenses beyond the current flat-ratio model. **Problem:** The Net Monthly Cash Flow currently uses subjective estimates for 5 of 7 expense categories: insurance (0.5% of value), maintenance (10% of rent), vacancy (3%), management (5%), and CapEx reserve (5%). Only mortgage and property taxes are based on real data. The current 45% total expense ratio (from `DEFAULT_EXPENSE_RATIOS`) cites CMHC/CORPIQ/TAL/bank models but uses a single midpoint — there's no scenario analysis or property-condition adjustment. Investors may question the accuracy of cash flow projections built on these defaults. **Files:** `src/housemktanalyzr/analysis/calculator.py:17-28` (DEFAULT_EXPENSE_RATIOS dict with sources), `src/housemktanalyzr/analysis/calculator.py:171-219` (estimate_monthly_expenses — 3-tier priority: actual Centris data → flat ratio → component breakdown), `frontend/src/components/PropertyDetail.tsx:282-301` (frontend expense breakdown display), `frontend/src/app/calculator/page.tsx:134-143` (expense ratio input). **Solution:** Research CORPIQ annual survey data, CMHC operating cost benchmarks, and APCHQ (Association des propriétaires du Québec) guidelines for per-category expense norms by property type/age/region. Consider adding: (1) a pessimistic/optimistic range instead of single estimates, (2) property-age adjustment (older buildings = higher maintenance), (3) regional vacancy rates from CMHC data already in the system, (4) a visual indicator showing which expenses are actual vs estimated.

## Fix Safety & Development for Non-Montreal Cities - 2026-02-10 20:15

- **Fix neighbourhood data lookup returning wrong borough for cities outside Montreal** - Properties in Longueuil, Quebec City, Sherbrooke, etc. incorrectly display Montreal borough data (e.g., Longueuil shows Ahuntsic-Cartierville stats). **Problem:** The frontend sends raw `listing.city` as the borough name (line 233: `property.listing.city || 'Montreal'`). The backend `get_neighbourhood_stats_for_borough()` does an exact match first, and when that fails (Longueuil is not a Montreal borough), it falls back to a dangerous `LIKE '%longueuil%'` partial match (db.py line 1282) which returns the first random Montreal borough match. The `resolve_borough()` function in `geo_mapping.py` exists to handle this correctly but is never called in the market API flow. **Files:** `frontend/src/components/PropertyDetail.tsx:232-237` (sends raw city, no postal code), `backend/app/routers/market.py:608-738` (neighbourhood endpoint — doesn't call `resolve_borough()`), `backend/app/db.py:1264-1288` (dangerous LIKE fallback), `backend/app/geo_mapping.py:230-259` (`resolve_borough()` — exists but unused in this flow). **Solution:** (1) Pass postal code from frontend alongside city. (2) Call `resolve_borough(city, postal_code)` in the market.py endpoint before querying DB. (3) Remove or tighten the LIKE fallback in db.py to prevent false matches. (4) Return null/empty when no valid borough match exists instead of wrong data.


