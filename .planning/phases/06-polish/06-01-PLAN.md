---
phase: 06-polish
plan: 01
type: execute
---

<objective>
Add tests for core functionality and fix any issues discovered.

Purpose: Ensure reliability of investment calculations, property analysis, and data collection. Build confidence in the tool's recommendations.
Output: Test suite covering critical paths with pytest.
</objective>

<context>
@.planning/BRIEF.md
@src/housemktanalyzr/analysis/calculator.py
@src/housemktanalyzr/analysis/ranker.py
@src/housemktanalyzr/models/property.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test fixtures and utilities</name>
  <files>tests/conftest.py, tests/__init__.py</files>
  <action>
    Create pytest fixtures for common test data:

    ```python
    @pytest.fixture
    def sample_listing() -> PropertyListing:
        """Sample duplex listing for testing."""

    @pytest.fixture
    def sample_listings() -> list[PropertyListing]:
        """Multiple listings of various types."""

    @pytest.fixture
    def calculator() -> InvestmentCalculator:
        """InvestmentCalculator instance."""

    @pytest.fixture
    def ranker() -> PropertyRanker:
        """PropertyRanker instance."""
    ```
  </action>
  <verify>pytest tests/conftest.py --collect-only</verify>
  <done>Test fixtures created</done>
</task>

<task type="auto">
  <name>Task 2: Test investment calculations</name>
  <files>tests/test_calculator.py</files>
  <action>
    Test InvestmentCalculator methods:

    - test_gross_rental_yield()
    - test_cap_rate()
    - test_gross_rent_multiplier()
    - test_mortgage_payment_canadian()
    - test_analyze_property_full()
    - test_score_calculation()

    Use known values to verify accuracy.
  </action>
  <verify>pytest tests/test_calculator.py -v</verify>
  <done>Calculator tests pass</done>
</task>

<task type="auto">
  <name>Task 3: Test property ranker</name>
  <files>tests/test_ranker.py</files>
  <action>
    Test PropertyRanker methods:

    - test_rank_by_score()
    - test_rank_by_cap_rate()
    - test_filter_by_criteria()
    - test_get_top_opportunities()
    - test_generate_report()
  </action>
  <verify>pytest tests/test_ranker.py -v</verify>
  <done>Ranker tests pass</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] All tests pass
- [ ] Coverage of critical calculation methods
- [ ] No regressions introduced
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- pytest runs clean
- Ready for 06-02 (documentation)
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish/06-01-SUMMARY.md`
</output>
