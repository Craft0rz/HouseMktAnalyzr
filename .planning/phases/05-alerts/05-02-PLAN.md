---
phase: 05-alerts
plan: 02
type: execute
---

<objective>
Implement alert checking and notification delivery system.

Purpose: Periodically check for new properties matching saved criteria and notify the user. Core success criteria from BRIEF.md.
Output: AlertChecker that finds matches and AlertNotifier for delivery.
</objective>

<context>
@.planning/BRIEF.md
@.planning/phases/05-alerts/05-01-SUMMARY.md
@src/housemktanalyzr/alerts/criteria.py
@src/housemktanalyzr/storage/cache.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AlertChecker</name>
  <files>src/housemktanalyzr/alerts/checker.py</files>
  <action>
    Create alert checker that finds matching properties:

    ```python
    class AlertChecker:
        """Check for properties matching alert criteria."""

        def __init__(self):
            self.scraper = CentrisScraper()
            self.ranker = PropertyRanker()
            self.cache = PropertyCache()
            self.criteria_mgr = CriteriaManager()

        async def check_criteria(
            self, criteria: AlertCriteria
        ) -> list[tuple[PropertyListing, InvestmentMetrics]]:
            """Find properties matching criteria."""

        async def check_all(self) -> dict[str, list]:
            """Check all enabled criteria, return matches by criteria ID."""

        def get_new_listings(
            self,
            current: list[PropertyListing],
            criteria_id: str,
        ) -> list[PropertyListing]:
            """Filter to only new listings (not seen before)."""
    ```

    Use cache to track previously seen listings.
  </action>
  <verify>python -c "from housemktanalyzr.alerts.checker import AlertChecker; print('AlertChecker OK')"</verify>
  <done>AlertChecker finds matching properties</done>
</task>

<task type="auto">
  <name>Task 2: Create AlertNotifier</name>
  <files>src/housemktanalyzr/alerts/notifier.py</files>
  <action>
    Create notification system:

    ```python
    class AlertNotifier:
        """Send alert notifications."""

        def notify_console(
            self,
            criteria: AlertCriteria,
            matches: list[tuple[PropertyListing, InvestmentMetrics]],
        ) -> None:
            """Print matches to console (rich formatted)."""

        def notify_email(
            self,
            criteria: AlertCriteria,
            matches: list[tuple[PropertyListing, InvestmentMetrics]],
        ) -> bool:
            """Send email notification (if configured)."""

        def generate_report(
            self,
            criteria: AlertCriteria,
            matches: list[tuple[PropertyListing, InvestmentMetrics]],
        ) -> str:
            """Generate text report of matches."""
    ```

    Email uses SMTP settings from environment/config.
  </action>
  <verify>python -c "from housemktanalyzr.alerts.notifier import AlertNotifier; print('AlertNotifier OK')"</verify>
  <done>AlertNotifier sends console and email notifications</done>
</task>

<task type="auto">
  <name>Task 3: Create CLI runner for scheduled checks</name>
  <files>src/housemktanalyzr/alerts/runner.py</files>
  <action>
    Create standalone runner for cron/scheduled execution:

    ```python
    async def run_alert_check():
        """Run all enabled alert checks and send notifications."""
        checker = AlertChecker()
        notifier = AlertNotifier()

        results = await checker.check_all()

        for criteria_id, matches in results.items():
            if matches:
                criteria = checker.criteria_mgr.load(criteria_id)
                notifier.notify_console(criteria, matches)
                if criteria.notify_email:
                    notifier.notify_email(criteria, matches)

    if __name__ == "__main__":
        asyncio.run(run_alert_check())
    ```

    Can be run via: `python -m housemktanalyzr.alerts.runner`
  </action>
  <verify>python -m housemktanalyzr.alerts.runner --help 2>&1 || echo "Runner module exists"</verify>
  <done>CLI runner can be scheduled via cron</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] AlertChecker finds matching properties
- [ ] Notifier prints formatted results to console
- [ ] Runner can be executed standalone
- [ ] New listings are tracked (not repeated)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Can run `python -m housemktanalyzr.alerts.runner` manually
- Phase 5 complete - ready for Phase 6 (Polish)
</success_criteria>

<output>
After completion, create `.planning/phases/05-alerts/05-02-SUMMARY.md`
</output>
