---
phase: 05-alerts
plan: 01
type: execute
---

<objective>
Implement saved search criteria and alert configuration system.

Purpose: Allow users to save investment criteria (region, price range, min score, etc.) that will be used to identify matching properties for alerts.
Output: AlertCriteria model and CriteriaManager for CRUD operations on saved searches.
</objective>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@src/housemktanalyzr/models/property.py
@src/housemktanalyzr/analysis/ranker.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AlertCriteria model</name>
  <files>src/housemktanalyzr/alerts/__init__.py, src/housemktanalyzr/alerts/criteria.py</files>
  <action>
    Create alert criteria data model:

    ```python
    class AlertCriteria(BaseModel):
        """Saved search criteria for property alerts."""
        id: str  # UUID
        name: str  # User-friendly name
        created_at: datetime
        updated_at: datetime
        enabled: bool = True

        # Search criteria
        regions: list[str]  # e.g., ["montreal-south-shore"]
        property_types: list[PropertyType]
        min_price: Optional[int] = None
        max_price: Optional[int] = None

        # Investment filters
        min_score: Optional[float] = None
        min_cap_rate: Optional[float] = None
        min_cash_flow: Optional[int] = None
        max_price_per_unit: Optional[int] = None

        # Notification settings
        notify_email: Optional[str] = None
        notify_on_new: bool = True
        notify_on_price_drop: bool = True
    ```
  </action>
  <verify>python -c "from housemktanalyzr.alerts.criteria import AlertCriteria; print('AlertCriteria OK')"</verify>
  <done>AlertCriteria model created with all filter fields</done>
</task>

<task type="auto">
  <name>Task 2: Create CriteriaManager for persistence</name>
  <files>src/housemktanalyzr/alerts/criteria.py</files>
  <action>
    Add manager class for saving/loading criteria:

    ```python
    class CriteriaManager:
        """Manage saved alert criteria."""

        def __init__(self, config_path: Path = None):
            self.config_path = config_path or Path.home() / ".housemktanalyzr" / "alerts.json"

        def save(self, criteria: AlertCriteria) -> None:
            """Save or update alert criteria."""

        def load(self, criteria_id: str) -> Optional[AlertCriteria]:
            """Load criteria by ID."""

        def list_all(self) -> list[AlertCriteria]:
            """List all saved criteria."""

        def delete(self, criteria_id: str) -> bool:
            """Delete criteria by ID."""

        def get_enabled(self) -> list[AlertCriteria]:
            """Get all enabled criteria for alert checking."""
    ```
  </action>
  <verify>python -c "
from housemktanalyzr.alerts.criteria import CriteriaManager, AlertCriteria
from housemktanalyzr.models.property import PropertyType
import tempfile
from pathlib import Path

mgr = CriteriaManager(Path(tempfile.gettempdir()) / 'test_alerts.json')
c = AlertCriteria(
    id='test-1', name='Test',
    regions=['montreal-south-shore'],
    property_types=[PropertyType.DUPLEX],
    min_score=60
)
mgr.save(c)
loaded = mgr.load('test-1')
print(f'Saved and loaded: {loaded.name}')
"</verify>
  <done>CriteriaManager handles JSON persistence</done>
</task>

<task type="auto">
  <name>Task 3: Add criteria to dashboard sidebar</name>
  <files>src/housemktanalyzr/dashboard/app.py</files>
  <action>
    Add "Save Search" functionality to dashboard:

    - Button to save current filter settings as alert criteria
    - Show list of saved alerts in sidebar
    - Toggle to enable/disable alerts
    - Delete saved criteria
  </action>
  <verify>Check that save/load criteria works in dashboard context</verify>
  <done>Dashboard can save and manage alert criteria</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] AlertCriteria model validates correctly
- [ ] CriteriaManager saves/loads from JSON
- [ ] Dashboard shows saved criteria
- [ ] Can enable/disable criteria
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Criteria persist between sessions
- Ready for 05-02 (alert generation)
</success_criteria>

<output>
After completion, create `.planning/phases/05-alerts/05-01-SUMMARY.md`
</output>
