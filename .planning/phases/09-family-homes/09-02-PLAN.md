---
phase: 09-family-homes
type: execute
---

<objective>
Create the frontend Houses section with a dedicated search page, family-specific filters, and a house detail page showing the Family Home Score breakdown.

Purpose: Families browsing houses need different UI than investors. Instead of cap rate/cash flow columns, they need livability scores, school info, cost of ownership, and space metrics.
Output: /houses search page, HouseDetail component, family score visualization, navigation entry.
</objective>

<execution_context>
@~/.claude/skills/create-plans/workflows/execute-phase.md
@~/.claude/skills/create-plans/templates/summary.md
</execution_context>

<context>
@.planning/BRIEF.md
@.planning/ROADMAP.md
@.planning/phases/09-family-homes/09-01-SUMMARY.md
@frontend/src/app/search/page.tsx
@frontend/src/lib/types.ts
@frontend/src/lib/api.ts
@frontend/src/i18n/en.json
@frontend/src/i18n/fr.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TypeScript types and API functions for family scoring</name>
  <files>frontend/src/lib/types.ts, frontend/src/lib/api.ts</files>
  <action>
Add to types.ts:

```typescript
export interface FamilyHomeMetrics {
  property_id: string;
  purchase_price: number;
  family_score: number;
  score_breakdown: Record<string, number>;

  // Pillar scores
  livability_score: number;
  walk_score_pts: number | null;
  transit_score_pts: number | null;
  safety_pts: number | null;
  school_proximity_pts: number | null;
  parks_pts: number | null;

  value_score: number;
  price_vs_assessment_pts: number | null;
  price_per_sqft: number | null;
  price_per_sqft_pts: number | null;
  monthly_cost_estimate: number | null;
  affordability_pts: number | null;
  market_trajectory_pts: number | null;

  space_score: number;
  lot_size_pts: number | null;
  bedroom_pts: number | null;
  condition_pts: number | null;
  age_pts: number | null;

  // Cost of ownership
  estimated_monthly_mortgage: number | null;
  estimated_monthly_taxes: number | null;
  estimated_annual_energy: number | null;
  estimated_annual_insurance: number | null;
  welcome_tax: number | null;
  total_cash_needed: number | null;

  // Risk flags
  flood_zone: boolean | null;
  contaminated_nearby: boolean | null;
}

export interface HouseWithScore {
  listing: PropertyListing;
  family_metrics: FamilyHomeMetrics;
}

export interface FamilyBatchResponse {
  results: HouseWithScore[];
  count: number;
  summary: Record<string, number>;
}
```

Add to api.ts a new `housesApi` object:
```typescript
export const housesApi = {
  scoreHouse: async (listing: PropertyListing): Promise<FamilyHomeMetrics> => { ... },
  scoreBatch: async (listings: PropertyListing[]): Promise<FamilyBatchResponse> => { ... },
  search: async (params: PropertySearchParams): Promise<FamilyBatchResponse> => { ... },
};
```

The `search` function should call GET /api/analysis/top-opportunities with property_types=HOUSE, then POST /api/analysis/family-score-batch with the results to get family scores.
  </action>
  <verify>cd frontend && npx tsc --noEmit 2>&1 | head -20</verify>
  <done>TypeScript types and API functions compile without errors</done>
</task>

<task type="auto">
  <name>Task 2: Create Houses search page</name>
  <files>frontend/src/app/houses/page.tsx</files>
  <action>
Create a new route at `/houses` (new directory `frontend/src/app/houses/page.tsx`).

The page should follow the same pattern as the existing `/search` page but adapted for houses:

**Filters (simplified for families):**
- Region selector (same as search page)
- Price range (min/max)
- Min bedrooms (2, 3, 4+)
- Min lot size (optional)

**Results display:**
- Default to card grid layout (not table — houses are visual)
- Each card shows:
  - Photo (first photo_url if available, placeholder if not)
  - Address + city
  - Price (formatted)
  - Family Score badge (circular, color-coded: green >= 70, yellow >= 50, red < 50)
  - Key stats row: bedrooms, bathrooms, sqft, lot_sqft
  - Three mini-bars showing pillar scores: Livability/40, Value/35, Space/25
  - Monthly cost estimate
- Sort by: Family Score (default), Price (asc/desc), Bedrooms, Lot Size
- Map view toggle (reuse existing PropertyMap component)

**Search flow:**
1. User sets filters → call housesApi.search()
2. Display results as cards
3. Click card → open HouseDetail sheet (Task 3)

Use existing UI components (Card, Badge, Button, Input, Select). Follow existing i18n pattern with `useTranslation()`.

Add navigation link: Add "Houses" to the app navigation/sidebar alongside existing Search, Alerts, Portfolio links.
  </action>
  <verify>cd frontend && npx tsc --noEmit 2>&1 | head -20</verify>
  <done>Houses page renders, filters work, card grid displays results with family scores</done>
</task>

<task type="auto">
  <name>Task 3: Create HouseDetail component</name>
  <files>frontend/src/components/HouseDetail.tsx</files>
  <action>
Create a slide-over detail sheet (same pattern as existing PropertyDetail if it exists, or a Sheet/Dialog component) for viewing full house details.

**Layout sections:**

1. **Header**: Photo gallery (carousel if multiple photos), address, price, family score badge (large)

2. **Score Breakdown** (3-column grid):
   - Livability card: circular progress showing X/40, list of sub-scores with labels
   - Value card: circular progress showing X/35, cost breakdown
   - Space card: circular progress showing X/25, property details

3. **Cost of Ownership** card:
   - Monthly mortgage payment
   - Monthly property taxes
   - Monthly energy estimate
   - Monthly insurance estimate
   - **Total monthly cost** (bold)
   - Welcome tax (one-time)
   - Total cash needed (down payment + welcome tax + closing)

4. **Property Details** card:
   - Bedrooms, Bathrooms, Sqft, Lot Sqft, Year Built
   - Walk Score / Transit Score / Bike Score (with colored badges)
   - Condition score with detail breakdown (if available)
   - Municipal assessment value

5. **Risk Flags** (only show if any flags):
   - Flood zone warning (red banner)
   - Contaminated site nearby warning (red banner)
   - "Data not yet available" message if null (grey)

6. **Action buttons**:
   - "View on Centris" (external link to listing.url)
   - "Add to Portfolio" (reuse existing portfolio add flow)

Use Tailwind CSS. Follow existing component patterns. All text must use i18n keys.
  </action>
  <verify>cd frontend && npx tsc --noEmit 2>&1 | head -20</verify>
  <done>HouseDetail component renders all sections, score visualization works, cost breakdown displays correctly</done>
</task>

<task type="auto">
  <name>Task 4: Add i18n keys for houses section</name>
  <files>frontend/src/i18n/en.json, frontend/src/i18n/fr.json</files>
  <action>
Add all necessary i18n keys under a new "houses" namespace. At minimum:

English:
```json
"houses": {
  "title": "Family Homes",
  "subtitle": "Find the perfect home for your family",
  "familyScore": "Family Score",
  "livability": "Livability",
  "value": "Value",
  "spaceComfort": "Space & Comfort",
  "walkScore": "Walk Score",
  "transitScore": "Transit Score",
  "safety": "Safety",
  "schoolProximity": "School Proximity",
  "parks": "Nearby Parks",
  "priceVsAssessment": "Price vs Assessment",
  "pricePerSqft": "Price per sqft",
  "affordability": "Affordability",
  "marketTrajectory": "Market Trend",
  "lotSize": "Lot Size",
  "bedrooms": "Bedrooms",
  "condition": "Condition",
  "propertyAge": "Property Age",
  "costOfOwnership": "Cost of Ownership",
  "monthlyMortgage": "Monthly Mortgage",
  "monthlyTaxes": "Monthly Taxes",
  "annualEnergy": "Annual Energy",
  "annualInsurance": "Annual Insurance",
  "welcomeTax": "Welcome Tax",
  "totalMonthlyCost": "Total Monthly Cost",
  "totalCashNeeded": "Total Cash Needed",
  "floodZoneWarning": "This property is in a flood zone",
  "contaminatedWarning": "Contaminated site nearby",
  "dataNotAvailable": "Data not yet available",
  "sortByScore": "Family Score",
  "sortByPrice": "Price",
  "sortByBedrooms": "Bedrooms",
  "sortByLotSize": "Lot Size",
  "minBedrooms": "Min Bedrooms",
  "minLotSize": "Min Lot Size",
  "viewOnCentris": "View on Centris",
  "noResults": "No houses found matching your criteria"
}
```

French:
```json
"houses": {
  "title": "Maisons Familiales",
  "subtitle": "Trouvez la maison parfaite pour votre famille",
  "familyScore": "Score Familial",
  "livability": "Habitabilité",
  "value": "Valeur",
  "spaceComfort": "Espace et Confort",
  "walkScore": "Score Marche",
  "transitScore": "Score Transport",
  "safety": "Sécurité",
  "schoolProximity": "Proximité Écoles",
  "parks": "Parcs à Proximité",
  "priceVsAssessment": "Prix vs Évaluation",
  "pricePerSqft": "Prix par pi²",
  "affordability": "Abordabilité",
  "marketTrajectory": "Tendance du Marché",
  "lotSize": "Terrain",
  "bedrooms": "Chambres",
  "condition": "État",
  "propertyAge": "Âge",
  "costOfOwnership": "Coût de Propriété",
  "monthlyMortgage": "Hypothèque Mensuelle",
  "monthlyTaxes": "Taxes Mensuelles",
  "annualEnergy": "Énergie Annuelle",
  "annualInsurance": "Assurance Annuelle",
  "welcomeTax": "Taxe de Bienvenue",
  "totalMonthlyCost": "Coût Mensuel Total",
  "totalCashNeeded": "Mise de Fonds Totale",
  "floodZoneWarning": "Cette propriété est en zone inondable",
  "contaminatedWarning": "Site contaminé à proximité",
  "dataNotAvailable": "Données pas encore disponibles",
  "sortByScore": "Score Familial",
  "sortByPrice": "Prix",
  "sortByBedrooms": "Chambres",
  "sortByLotSize": "Terrain",
  "minBedrooms": "Chambres min.",
  "minLotSize": "Terrain min.",
  "viewOnCentris": "Voir sur Centris",
  "noResults": "Aucune maison trouvée selon vos critères"
}
```
  </action>
  <verify>node -e "JSON.parse(require('fs').readFileSync('frontend/src/i18n/en.json','utf8')); console.log('en.json OK')" && node -e "JSON.parse(require('fs').readFileSync('frontend/src/i18n/fr.json','utf8')); console.log('fr.json OK')"</verify>
  <done>Both language files parse as valid JSON, all houses.* keys present in both languages</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `cd frontend && npx tsc --noEmit` passes without errors
- [ ] `/houses` route renders without crash
- [ ] Family score cards display with correct color coding
- [ ] HouseDetail shows all three pillar breakdowns
- [ ] Cost of ownership section shows monthly totals
- [ ] Navigation includes "Houses" link
- [ ] All text uses i18n (no hardcoded English strings)
- [ ] Both en.json and fr.json parse correctly
</verification>

<success_criteria>
- /houses page displays house listings with family scores in card grid
- Filters work: region, price range, bedrooms, lot size
- HouseDetail component shows score breakdown, cost of ownership, risk flags
- Map view toggle works (reuses PropertyMap)
- All strings internationalized (EN + FR)
- Navigation updated with Houses link
- No changes to existing /search page or investment scoring
</success_criteria>

<output>
After completion, create `.planning/phases/09-family-homes/09-02-SUMMARY.md`
</output>
